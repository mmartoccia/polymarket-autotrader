## Iteration 1 - OrderBookAgent Implementation
- Implemented OrderBookAgent with microstructure analysis
- Files changed:
  - agents/voting/orderbook_agent.py (NEW - 600+ lines)
  - tests/test_orderbook_agent.py (NEW - 12 unit tests, all passing)
  - PRD.md (marked task complete)
- Learnings for future iterations:
  - Polymarket binary markets: price represents probability (Up=$0.60 = 60% chance Up wins)
  - For simplified orderbook format, synthetic imbalance = (up_price - down_price) / 2
  - Wide spreads (>10%) indicate low liquidity and should reduce quality score
  - Agent must handle both detailed orderbook (from ClobClient.get_order_book) and simplified format (current bot)
  - Use >= instead of > for threshold comparisons to avoid edge case issues
  - All agents should return Vote with direction, confidence, quality, reasoning, details
  - BaseAgent is located at agents/base_agent.py, not agents/voting/base_agent.py
---

## Iteration 2 - FundingRateAgent Implementation
- Implemented FundingRateAgent with derivatives market analysis
- Files changed:
  - agents/voting/funding_rate_agent.py (NEW - 400+ lines)
  - tests/test_funding_rate_agent.py (NEW - 13 unit tests, all passing)
  - PRD.md (marked task complete)
- Learnings for future iterations:
  - Binance Futures API is public (no auth required) for funding rates, open interest, tickers
  - Funding rate interpretation:
    - Positive = longs pay shorts = too many longs = potential DOWN reversal
    - Negative = shorts pay longs = too many shorts = potential UP reversal
    - Extreme (>0.10%) = contrarian reversal signal (70% confidence)
    - Moderate (0.05-0.10%) = aligned continuation signal (50% confidence)
  - Threshold consistency: OI thresholds must match percentage format (5.0 = 5%, not 0.05)
  - Caching pattern: 60-second TTL reduces API load while keeping data fresh
  - Exception handling: catch broad Exception for mocked requests in tests
  - Funding rate is returned as decimal (0.0001) but convert to % (0.01%) for clarity
  - API responses: fundingRate, openInterest, volume from different endpoints
---

## Iteration 3 - Add OrderBook + FundingRate to Shadow Strategies
- Added OrderBookAgent and FundingRateAgent to shadow trading system
- Files changed:
  - config/agent_config.py (added OrderBookAgent + FundingRateAgent to AGENT_WEIGHTS)
  - simulation/strategy_configs.py (updated all 24 existing strategies + added 6 new Phase 1 strategies)
  - PRD.md (marked task complete)
- New shadow strategies created:
  - orderbook_focused (1.5x OrderBook weight)
  - funding_rate_focused (1.5x FundingRate weight)
  - phase1_combo (1.2x both new agents)
  - orderbook_only (isolate OrderBook performance)
  - funding_rate_only (isolate FundingRate performance)
  - phase1_only (both new agents, no legacy)
- Total shadow strategies: 18 (from 12)
- Learnings for future iterations:
  - Strategy configs use default_factory for agent_weights - must update both default AND all existing strategies
  - Each strategy needs OrderBookAgent + FundingRateAgent added to agent_weights dict
  - SHADOW_STRATEGIES list in agent_config.py controls which strategies run in parallel
  - Isolating individual agents (X_only strategies) requires setting other agents to 0.0 weight
  - Phase 1 strategies should have lower consensus thresholds (0.30-0.40) when using 1-2 agents
  - All 30 strategy configs validated and loadable (tested with get_strategy())
  - Shadow system now has 6 strategies specifically for testing new Phase 1 agents
---

## Iteration 4 - Deploy Phase 1 Agents to VPS
- Integrated OrderBookAgent and FundingRateAgent into live bot via AgentSystemWrapper
- Files changed:
  - bot/agent_wrapper.py (added OrderBook + FundingRate agent imports and initialization logic)
  - PRD.md (marked "Deploy to VPS" task complete)
- Deployment process:
  1. Updated agent_wrapper.py to import OrderBookAgent and FundingRateAgent
  2. Added conditional initialization based on agent_weights configuration
  3. Verified all 25 tests pass locally (12 OrderBook + 13 FundingRate)
  4. Committed and pushed to GitHub (commit 1500fe3)
  5. SSH'd to VPS and ran ./scripts/deploy.sh
  6. Cleared Python cache (.pyc files) to ensure fresh module loading
  7. Verified agents initialized: "Tech, Sentiment, Regime, Candlestick, OrderBook, FundingRate"
- Current VPS status:
  - Bot service: active (running)
  - Agents loaded: 6 agents (4 legacy + 2 Phase 1) for strategies with new agents enabled
  - Shadow strategies: 17 strategies running (6 Phase 1-specific strategies included)
  - Trading status: HALTED (50.4% drawdown - needs manual peak balance reset)
- Learnings for future iterations:
  - AgentSystemWrapper uses config/agent_config.py by default (no args needed)
  - New agents are conditionally loaded based on AGENT_WEIGHTS dict (weight > 0)
  - Shadow strategies can have different agent configurations (some 4 agents, some 6 agents)
  - Python bytecode cache must be cleared after updating agent code (.pyc files)
  - VPS deployment script (./scripts/deploy.sh) handles: git pull, service restart, status check
  - Agent initialization logging shows "N AGENTS" count and agent list for verification
  - Deployment mode (moderate/conservative/aggressive) only affects thresholds, not which agents load
  - Live bot agent configuration is separate from shadow strategy configurations
  - Agents are ready to trade once drawdown is reset (bot currently halted, not a deployment issue)
---

